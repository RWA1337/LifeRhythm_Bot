import os
import random
from datetime import datetime, date
from typing import List, Dict

from flask import Flask, request, jsonify, abort

from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import (
    ApplicationBuilder,
    Application,
    CommandHandler,
    ContextTypes,
)

# ==============================
# –ö–æ–Ω—Ñ–∏–≥
# ==============================
TOKEN = os.getenv("BOT_TOKEN")
if not TOKEN:
    raise RuntimeError("Env var BOT_TOKEN is not set")

PORT = int(os.getenv("PORT", "10000"))  # Render –æ–±—ã—á–Ω–æ –¥–∞—ë—Ç 10000
BASE_URL = os.getenv("BASE_URL", "https://liferhythm-bot.onrender.com")
WEBHOOK_PATH = "/webhook"  # –º–æ–∂–µ—à—å –ø–æ–º–µ–Ω—è—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä "/webhook-secret"
WEBHOOK_URL = f"{BASE_URL}{WEBHOOK_PATH}"

# ==============================
# –î–∞–Ω–Ω—ã–µ (–Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã)
# ==============================

EXERCISE_SETS: List[Dict] = [
    {
        "title": "–ë—ã—Å—Ç—Ä–∞—è —É—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞ (5‚Äì7 –º–∏–Ω)",
        "steps": [
            "–ü—Ä—ã–∂–∫–∏ –Ω–∞ –º–µ—Å—Ç–µ ‚Äî 30 —Å–µ–∫",
            "–ö—Ä—É–≥–æ–≤—ã–µ –≤—Ä–∞—â–µ–Ω–∏—è —Ä—É–∫–∞–º–∏ ‚Äî 20 —Å–µ–∫",
            "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è ‚Äî 12 —Ä–∞–∑",
            "–ü–ª–∞–Ω–∫–∞ ‚Äî 30 —Å–µ–∫",
            "–ù–∞–∫–ª–æ–Ω—ã –∫ –Ω–æ—Å–∫–∞–º ‚Äî 10 —Ä–∞–∑"
        ],
        "note": "–õ—ë–≥–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –±–µ–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è."
    },
    {
        "title": "–°–∏–ª–æ–≤–æ–π –∫–æ–º–ø–ª–µ–∫—Å –±–µ–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (10 –º–∏–Ω)",
        "steps": [
            "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è ‚Äî 15",
            "–û—Ç–∂–∏–º–∞–Ω–∏—è (–æ—Ç –ø–æ–ª–∞/—Å—Ç–µ–Ω—ã) ‚Äî 10",
            "–í—ã–ø–∞–¥—ã ‚Äî –ø–æ 10 –Ω–∞ –Ω–æ–≥—É",
            "–ü–ª–∞–Ω–∫–∞ ‚Äî 40 —Å–µ–∫",
            "–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è ‚Äî 15"
        ],
        "note": "–î—ã—à–∏ —Ä–æ–≤–Ω–æ, –¥–≤–∏–∂–µ–Ω–∏–µ –≤ —Å—Ä–µ–¥–Ω–µ–º —Ç–µ–º–ø–µ."
    },
    {
        "title": "–ö–∞—Ä–¥–∏–æ-–¥–æ–º (8‚Äì10 –º–∏–Ω)",
        "steps": [
            "–ë—ë—Ä–ø–∏ –æ–±–ª–µ–≥—á—ë–Ω–Ω—ã–µ ‚Äî 8",
            "–ë–µ–≥ –Ω–∞ –º–µ—Å—Ç–µ ‚Äî 45 —Å–µ–∫",
            "–ü—Ä—ã–∂–∫–∏ ¬´–¥–∂–∞–º–ø–∏–Ω–≥ –¥–∂–µ–∫¬ª ‚Äî 30 —Å–µ–∫",
            "–í—ã—Å–æ–∫–∏–µ –∫–æ–ª–µ–Ω–∏ ‚Äî 30 —Å–µ–∫",
            "–°–ø–æ–∫–æ–π–Ω–∞—è —Ö–æ–¥—å–±–∞ ‚Äî 1 –º–∏–Ω"
        ],
        "note": "–°–ª–µ–¥–∏ –∑–∞ –ø—É–ª—å—Å–æ–º, –Ω–µ –ø–µ—Ä–µ–≥—Ä–µ–≤–∞–π—Å—è."
    },
    {
        "title": "–ú–æ–±–∏–ª–∏—Ç–∏ –¥–ª—è —Å–ø–∏–Ω—ã –∏ –±—ë–¥–µ—Ä (7‚Äì9 –º–∏–Ω)",
        "steps": [
            "–ö–æ—à–∫–∞-–∫–æ—Ä–æ–≤–∞ ‚Äî 8‚Äì10 —Ü–∏–∫–ª–æ–≤",
            "–ü–æ–≤–æ—Ä–æ—Ç—ã –∫–æ—Ä–ø—É—Å–∞ —Å—Ç–æ—è ‚Äî 10",
            "–í—ã–ø–∞–¥ —Å —Ä–∞—Å—Ç—è–∂–∫–æ–π —Å–≥–∏–±–∞—Ç–µ–ª–µ–π ‚Äî –ø–æ 30 —Å–µ–∫",
            "–°–∫—Ä—É—Ç–∫–∞ –ª—ë–∂–∞ ‚Äî –ø–æ 30 —Å–µ–∫",
            "–ù–∞–∫–ª–æ–Ω –∏–∑ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Å–∏–¥—è ‚Äî 40 —Å–µ–∫"
        ],
        "note": "–†–∞–±–æ—Ç–∞–π –º—è–≥–∫–æ, –±–µ–∑ –±–æ–ª–∏."
    },
    {
        "title": "–û—Ñ–∏—Å-–º–∏–∫—Ä–æ-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (4‚Äì6 –º–∏–Ω)",
        "steps": [
            "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —É —Å—Ç—É–ª–∞ ‚Äî 12",
            "–û—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç —Å—Ç–æ–ª–∞ ‚Äî 10",
            "–ü–æ–¥—ä—ë–º –Ω–∞ –Ω–æ—Å–∫–∏ ‚Äî 20",
            "–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ –ª–æ–ø–∞—Ç–æ–∫ ‚Äî 12",
            "–®–µ—è: –Ω–∞–∫–ª–æ–Ω—ã ‚Äî –ø–æ 6 –≤ —Å—Ç–æ—Ä–æ–Ω—ã"
        ],
        "note": "–†–∞–∑–æ–º–Ω—ë—Ç, –µ—Å–ª–∏ —Å–∏–¥–∏—à—å –¥–æ–ª–≥–æ."
    },
    {
        "title": "–ö–æ—Ä (–ø—Ä–µ—Å—Å/—Å–ø–∏–Ω–∞) (8‚Äì10 –º–∏–Ω)",
        "steps": [
            "–ü–ª–∞–Ω–∫–∞ ‚Äî 30‚Äì45 —Å–µ–∫",
            "–ë–æ–∫–æ–≤–∞—è –ø–ª–∞–Ω–∫–∞ ‚Äî –ø–æ 25‚Äì30 —Å–µ–∫",
            "–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è ‚Äî 15",
            "¬´–ù–æ–∂–Ω–∏—Ü—ã¬ª ‚Äî 20 —Å–µ–∫",
            "–ì–∏–ø–µ—Ä—ç–∫—Å—Ç–µ–Ω–∑–∏—è –ª—ë–∂–∞ ‚Äî 12‚Äì15"
        ],
        "note": "–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—è—Å–Ω–∏—Ü—ã, –Ω–µ –ø—Ä–æ–≥–∏–±–∞–π—Å—è —á—Ä–µ–∑–º–µ—Ä–Ω–æ."
    },
    {
        "title": "–ù–æ–≥–∏ –∏ —è–≥–æ–¥–∏—Ü—ã (10‚Äì12 –º–∏–Ω)",
        "steps": [
            "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è ‚Äî 15",
            "–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç ‚Äî 15‚Äì20",
            "–í—ã–ø–∞–¥—ã –Ω–∞–∑–∞–¥ ‚Äî –ø–æ 10",
            "–ü—É–ª—å—Å–∏—Ä—É—é—â–∏–µ –ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è ‚Äî 12",
            "–†–∞—Å—Ç—è–∂–∫–∞ –∫–≤–∞–¥—Ä–∏—Ü–µ–ø—Å–∞ ‚Äî –ø–æ 30 —Å–µ–∫"
        ],
        "note": "–ö–æ–ª–µ–Ω–∏ –Ω–∞–ø—Ä–∞–≤–ª—è–π –≤ —Å—Ç–æ—Ä–æ–Ω—É –Ω–æ—Å–∫–æ–≤."
    },
    {
        "title": "–ì—Ä—É–¥—å/–ø–ª–µ—á–∏ (10 –º–∏–Ω)",
        "steps": [
            "–û—Ç–∂–∏–º–∞–Ω–∏—è (–≤–∞—Ä–∏–∞–Ω—Ç –ø–æ —É—Ä–æ–≤–Ω—é) ‚Äî 10‚Äì12",
            "–û—Ç–∂–∏–º–∞–Ω–∏—è —É–∑–∫–∏–º —Ö–≤–∞—Ç–æ–º ‚Äî 8‚Äì10",
            "–£–ø–æ—Ä –Ω–∞ –ø—Ä–µ–¥–ø–ª–µ—á—å—è ‚Äî 40 —Å–µ–∫",
            "–ü–ª–∏–µ-–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è ‚Äî 12",
            "–†–∞—Å—Ç—è–∂–∫–∞ –≥—Ä—É–¥–∏ —É —Å—Ç–µ–Ω—ã ‚Äî 30 —Å–µ–∫"
        ],
        "note": "–°–ª–µ–¥–∏ –∑–∞ –ø–ª–µ—á–∞–º–∏ ‚Äî –Ω–µ –∑–∞–¥–∏—Ä–∞–π –∏—Ö –∫ —É—à–∞–º."
    },
    {
        "title": "–ö–∞—Ä–¥–∏–æ-–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (12 –º–∏–Ω)",
        "steps": [
            "–ë–µ–≥ –Ω–∞ –º–µ—Å—Ç–µ ‚Äî 60 —Å–µ–∫",
            "–ü—Ä—ã–∂–∫–∏ ‚Äî 30 —Å–µ–∫",
            "–•–æ–¥—å–±–∞ ‚Äî 60 —Å–µ–∫",
            "–í—ã—Å–æ–∫–∏–µ –∫–æ–ª–µ–Ω–∏ ‚Äî 30 —Å–µ–∫",
            "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å 2‚Äì3 –∫—Ä—É–≥–∞"
        ],
        "note": "–ü–µ–π –≤–æ–¥—É –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –≥–ª–æ—Ç–∫–∞–º–∏."
    },
    {
        "title": "–†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–π –≤–µ—á–µ—Ä–Ω–∏–π –∫–æ–º–ø–ª–µ–∫—Å (6‚Äì8 –º–∏–Ω)",
        "steps": [
            "–ù–∞–∫–ª–æ–Ω —Å—Ç–æ—è ‚Äî 40 —Å–µ–∫",
            "–°–∫—Ä—É—Ç–∫–∞ –ª—ë–∂–∞ ‚Äî –ø–æ 30 —Å–µ–∫",
            "–ü–æ–∑–∞ —Ä–µ–±—ë–Ω–∫–∞ ‚Äî 40 —Å–µ–∫",
            "–î–∏–∞—Ñ—Ä–∞–≥–º–∞–ª—å–Ω–æ–µ –¥—ã—Ö–∞–Ω–∏–µ ‚Äî 1‚Äì2 –º–∏–Ω"
        ],
        "note": "–ó–∞–º–µ–¥–ª—è–π—Å—è –∫ –≤–µ—á–µ—Ä—É, –≥–æ—Ç–æ–≤—å—Å—è –∫–æ —Å–Ω—É."
    },
    # –ï—â—ë 10 –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:
    *[
        {
            "title": f"–ú–∏–Ω–∏-–∫–æ–º–ø–ª–µ–∫—Å #{i}",
            "steps": [
                "20 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π",
                "10‚Äì15 –æ—Ç–∂–∏–º–∞–Ω–∏–π (–æ—Ç —Å—Ç–µ–Ω—ã/–∫–æ–ª–µ–Ω)",
                "–ü–ª–∞–Ω–∫–∞ 30‚Äì40 —Å–µ–∫",
                "–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è 12‚Äì15",
            ],
            "note": "–ë—ã—Å—Ç—Ä—ã–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∫—Ä—É–≥."
        }
        for i in range(11, 21)
    ]
]

BREATHING_TECHNIQUES: List[Dict] = [
    {"title": "4-4-4", "how": "–í–¥–æ—Ö 4 —Å–µ–∫ ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ 4 ‚Äî –≤—ã–¥–æ—Ö 4. –ü–æ–≤—Ç–æ—Ä–∏ 6‚Äì8 —Ü–∏–∫–ª–æ–≤."},
    {"title": "4-7-8", "how": "–í–¥–æ—Ö 4 ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ 7 ‚Äî –≤—ã–¥–æ—Ö 8. 4‚Äì6 —Ü–∏–∫–ª–æ–≤, –ø–µ—Ä–µ–¥ —Å–Ω–æ–º."},
    {"title": "Box breathing 4-4-4-4", "how": "–í–¥–æ—Ö ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ ‚Äî –≤—ã–¥–æ—Ö ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ 4 —Å–µ–∫. 5‚Äì10 —Ü–∏–∫–ª–æ–≤."},
    {"title": "–£–¥–¥–∏—è–Ω–∞ —Å –º—è–≥–∫–∏–º –∂–∏–≤–æ—Ç–æ–º", "how": "–°–ø–æ–∫–æ–π–Ω—ã–π –≤–¥–æ—Ö/–≤—ã–¥–æ—Ö —á–µ—Ä–µ–∑ –Ω–æ—Å, –∂–∏–≤–æ—Ç –º—è–≥–∫–∏–π. 2‚Äì3 –º–∏–Ω."},
    {"title": "–î—ã—Ö–∞–Ω–∏–µ –ø–æ —Å—á—ë—Ç—É", "how": "–í–¥–æ—Ö –Ω–∞ 5, –≤—ã–¥–æ—Ö –Ω–∞ 7. 2‚Äì5 –º–∏–Ω, —É–¥–ª–∏–Ω—è–π –≤—ã–¥–æ—Ö."},
    {"title": "–ß–µ—Ä–µ–∑ –æ–¥–Ω—É –Ω–æ–∑–¥—Ä—é", "how": "–ó–∞–∂–∏–º–∞–π –ø–æ –æ—á–µ—Ä–µ–¥–∏ –Ω–æ–∑–¥—Ä–∏: –≤–¥–æ—Ö –ª–µ–≤–æ–π ‚Äî –≤—ã–¥–æ—Ö –ø—Ä–∞–≤–æ–π –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç. 3‚Äì5 –º–∏–Ω."},
    {"title": "–ö–æ—Ö–µ—Ä–µ–Ω—Ç–Ω–æ–µ 5-5", "how": "–í–¥–æ—Ö 5 —Å–µ–∫ ‚Äî –≤—ã–¥–æ—Ö 5 —Å–µ–∫. 5‚Äì10 –º–∏–Ω –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏."},
    {"title": "¬´–®–∏–ø—è—â–µ–µ¬ª (—É–¥–∂–∞–π–∏)", "how": "–î—ã—à–∏ —á–µ—Ä–µ–∑ –Ω–æ—Å —Å –ª—ë–≥–∫–∏–º ¬´—à–∏–ø–µ–Ω–∏–µ–º¬ª –≤ –≥–æ—Ä–ª–µ. 2‚Äì5 –º–∏–Ω."},
    {"title": "–î—ã—Ö–∞–Ω–∏–µ –∂–∏–≤–æ—Ç–æ–º", "how": "–õ—ë–∂–∞, –ª–∞–¥–æ–Ω—å –Ω–∞ –∂–∏–≤–æ—Ç–µ. –í–¥–æ—Ö ‚Äî –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è, –≤—ã–¥–æ—Ö ‚Äî –æ–ø—É—Å–∫–∞–µ—Ç—Å—è. 3‚Äì6 –º–∏–Ω."},
    {"title": "360¬∞ –¥—ã—Ö–∞–Ω–∏–µ", "how": "–†–∞—Å—à–∏—Ä—è–π –±–æ–∫–∞ –∏ —Å–ø–∏–Ω—É –Ω–∞ –≤–¥–æ—Ö–µ. 2‚Äì4 –º–∏–Ω."},
    {"title": "6-—Å–µ–∫ –≤–¥–æ—Ö / 6-—Å–µ–∫ –≤—ã–¥–æ—Ö", "how": "–†–æ–≤–Ω—ã–π —Ü–∏–∫–ª 6/6. 5 –º–∏–Ω –¥–ª—è —Ñ–æ–∫—É—Å–∞."},
    {"title": "–í—ã–¥–æ—Ö –¥–ª–∏–Ω–Ω–µ–µ", "how": "–í–¥–æ—Ö 3‚Äì4, –≤—ã–¥–æ—Ö 6‚Äì8. –£—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç. 3‚Äì5 –º–∏–Ω."},
    {"title": "–®–∞–≥–æ–≤–æ–µ –¥—ã—Ö–∞–Ω–∏–µ", "how": "–ü—Ä–∏ —Ö–æ–¥—å–±–µ: –≤–¥–æ—Ö –Ω–∞ 3 —à–∞–≥–∞, –≤—ã–¥–æ—Ö –Ω–∞ 4‚Äì5. 5‚Äì10 –º–∏–Ω."},
    {"title": "–î—ã—Ö–∞–Ω–∏–µ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π", "how": "–ù–∞ –≤–¥–æ—Ö–µ ‚Äî —Å–≤–µ—Ç, –Ω–∞ –≤—ã–¥–æ—Ö–µ ‚Äî –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ —É—Ö–æ–¥–∏—Ç. 3‚Äì5 –º–∏–Ω."},
    {"title": "¬´–ü—á–µ–ª–∞¬ª (–±—Ö—Ä–∞–º–∞—Ä–∏)", "how": "–ì—É–¥—è—â–∏–π –≤—ã–¥–æ—Ö –∫–∞–∫ ¬´–º-–º-–º¬ª. 6‚Äì10 –≤—ã–¥–æ—Ö–æ–≤."},
    {"title": "–†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–π —Å—á—ë—Ç 10‚Üí1", "how": "–ù–∞ –∫–∞–∂–¥–æ–º –≤—ã–¥–æ—Ö–µ —Å—á–∏—Ç–∞–π –≤–Ω–∏–∑. 2‚Äì3 –º–∏–Ω."},
    {"title": "–ú–µ—Ç—Ç–∞-–º–µ–¥–∏—Ç–∞—Ü–∏—è", "how": "–ù–∞ –≤—ã–¥–æ—Ö–µ: ¬´–ü—É—Å—Ç—å —è –±—É–¥—É —Å–ø–æ–∫–æ–µ–Ω‚Ä¶¬ª 3‚Äì5 –º–∏–Ω."},
    {"title": "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞", "how": "–ü—Ä–æ—Ö–æ–¥–∏ –≤–Ω–∏–º–∞–Ω–∏–µ–º –æ—Ç –º–∞–∫—É—à–∫–∏ –∫ —Å—Ç–æ–ø–∞–º. 5‚Äì10 –º–∏–Ω."},
    {"title": "–ö–≤–∞–¥—Ä–∞—Ç—ã –≤–Ω–∏–º–∞–Ω–∏—è", "how": "–í–∑–≥–ª—è–¥–æ–º –≤–µ–¥–∏ –≤–æ–æ–±—Ä–∞–∂–∞–µ–º—ã–π –∫–≤–∞–¥—Ä–∞—Ç, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å 4-4-4-4. 2‚Äì4 –º–∏–Ω."},
    {"title": "–î—ã—Ö–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º", "how": "–í–¥–æ—Ö 4 ‚Äî –≤—ã–¥–æ—Ö 8, –ª—ë–∂–∞ –≤ —Ç–µ–º–Ω–æ—Ç–µ. 5‚Äì8 –º–∏–Ω."},
]

YOGA_POSES: List[Dict] = [
    {"title": "–¢–∞–¥–∞—Å–∞–Ω–∞ (–ì–æ—Ä–∞)", "how": "–ù–æ–≥–∏ –≤–º–µ—Å—Ç–µ, –º–∞–∫—É—à–∫–∞ –≤–≤–µ—Ä—Ö, –ø–ª–µ—á–∏ –≤–Ω–∏–∑, –¥—ã—Ö–∞–Ω–∏–µ —Ä–æ–≤–Ω–æ–µ ‚Äî 30‚Äì60 —Å–µ–∫."},
    {"title": "–í—Ä–∏–∫—à–∞—Å–∞–Ω–∞ (–î–µ—Ä–µ–≤–æ)", "how": "–°—Ç–æ–π –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–≥–µ, —Å—Ç–æ–ø—É –¥—Ä—É–≥–æ–π –Ω–∞ –±–µ–¥—Ä–æ, –ª–∞–¥–æ–Ω–∏ –∫ –≥—Ä—É–¥–∏ –∏–ª–∏ –≤–≤–µ—Ä—Ö ‚Äî 30‚Äì60 —Å–µ–∫."},
    {"title": "–ê—Ä–¥—Ö–∞ —É—Ç—Ç–∞–Ω–∞—Å–∞–Ω–∞ (–ü–æ–ª—É–Ω–∫–∞–ª–æ–Ω)", "how": "–ù–∞–∫–ª–æ–Ω –≤–ø–µ—Ä—ë–¥, —Å–ø–∏–Ω–∞ –¥–ª–∏–Ω–Ω–∞—è, —Ä—É–∫–∏ –Ω–∞ –≥–æ–ª–µ–Ω—è—Ö ‚Äî 30 —Å–µ–∫."},
    {"title": "–ê—à–≤–∞ —Å–∞–Ω—á–∞–ª–∞—Å–∞–Ω–∞ (–í—ã–ø–∞–¥)", "how": "–î–ª–∏–Ω–Ω—ã–π —à–∞–≥ –Ω–∞–∑–∞–¥, –∫–æ–ª–µ–Ω–æ –≤–Ω–∏–∑/–≤–≤–µ—Ä—Ö, –≥—Ä—É–¥—å –≤–ø–µ—Ä—ë–¥ ‚Äî 30 —Å–µ–∫/—Å—Ç–æ—Ä–æ–Ω–∞."},
    {"title": "–ê–¥—Ö–æ –º—É–∫—Ö–∞ —à–≤–∞–Ω–∞—Å–∞–Ω–∞ (–°–æ–±–∞–∫–∞ –º–æ—Ä–¥–æ–π –≤–Ω–∏–∑)", "how": "–õ–∞–¥–æ–Ω–∏ –∂–º—É—Ç –ø–æ–ª, —Ç–∞–∑ –≤–≤–µ—Ä—Ö, —à–µ—è –¥–ª–∏–Ω–Ω–∞—è ‚Äî 30‚Äì45 —Å–µ–∫."},
    {"title": "–ë–∞–ª–∞—Å–∞–Ω–∞ (–†–µ–±—ë–Ω–æ–∫)", "how": "–°—è–¥—å –Ω–∞ –ø—è—Ç–∫–∏, –ª–æ–± –Ω–∞ –∫–æ–≤—Ä–∏–∫, —Ä—É–∫–∏ –≤–ø–µ—Ä—ë–¥ ‚Äî 40‚Äì60 —Å–µ–∫."},
    {"title": "–ë—Ö—É–¥–∂–∞–Ω–≥–∞—Å–∞–Ω–∞ (–ö–æ–±—Ä–∞)", "how": "–õ—ë–∂–∞ –Ω–∞ –∂–∏–≤–æ—Ç–µ, –º—è–≥–∫–∏–π –ø—Ä–æ–≥–∏–±, –ª–æ–∫—Ç–∏ –±–ª–∏–∑–∫–æ ‚Äî 20‚Äì30 —Å–µ–∫."},
    {"title": "–ê–ø–∞–Ω–∞c–∞–Ω–∞ (–ö–æ–ª–µ–Ω–∏ –∫ –≥—Ä—É–¥–∏)", "how": "–õ—ë–∂–∞, –æ–±–Ω–∏–º–∏ –∫–æ–ª–µ–Ω–∏, –ø–æ–∫–∞—á–∞–π—Å—è ‚Äî 40 —Å–µ–∫."},
    {"title": "–°—É–ø—Ç–∞ –º–∞—Ç—Å–∏–µ–Ω–¥—Ä–∞—Å–∞–Ω–∞ (–°–∫—Ä—É—Ç–∫–∞ –ª—ë–∂–∞)", "how": "–ö–æ–ª–µ–Ω–∏ –≤–±–æ–∫, –ø–ª–µ—á–∏ –Ω–∞ –ø–æ–ª—É ‚Äî 30‚Äì40 —Å–µ–∫/—Å—Ç–æ—Ä–æ–Ω–∞."},
    {"title": "–î–∞–Ω–¥–∞—Å–∞–Ω–∞ (–ü–æ—Å–æ—Ö)", "how": "–°–∏–¥—è, –Ω–æ–≥–∏ –≤–ø–µ—Ä—ë–¥, —Å–ø–∏–Ω–∞ —Ä–æ–≤–Ω–∞—è ‚Äî 40 —Å–µ–∫."},
    {"title": "–ü–∞—à—á–∏–º–æ—Ç—Ç–∞–Ω–∞—Å–∞–Ω–∞ (–ù–∞–∫–ª–æ–Ω —Å–∏–¥—è)", "how": "–ù–∞–∫–ª–æ–Ω –∫ —Å—Ç–æ–ø–∞–º, —Å–ø–∏–Ω–∞ –¥–ª–∏–Ω–Ω–∞—è ‚Äî 40‚Äì60 —Å–µ–∫."},
    {"title": "–°–µ—Ç—É –±–∞–Ω–¥—Ö–∞ —Å–∞—Ä–≤–∞–Ω–≥–∞—Å–∞–Ω–∞ (–ú–æ—Å—Ç)", "how": "–õ—ë–∂–∞, —Ç–∞–∑ –≤–≤–µ—Ä—Ö, –ª–æ–ø–∞—Ç–∫–∏ –∫ —Ü–µ–Ω—Ç—Ä—É ‚Äî 20‚Äì30 —Å–µ–∫."},
    {"title": "–®–∞–≤–∞—Å–∞–Ω–∞", "how": "–ü–æ–ª–Ω–æ–µ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ –ª—ë–∂–∞ ‚Äî 2‚Äì5 –º–∏–Ω."},
    {"title": "–£—Ç–∫–∞—Ç–∞—Å–∞–Ω–∞ (–°—Ç—É–ª)", "how": "–ü–æ–ª—É–ø—Ä–∏—Å–µ–¥, —Ä—É–∫–∏ –≤–≤–µ—Ä—Ö, –∂–∏–≤–æ—Ç –≤ —Ç–æ–Ω—É—Å–µ ‚Äî 30‚Äì40 —Å–µ–∫."},
    {"title": "–í–∏—Ä–∞–±—Ö–∞–¥—Ä–∞—Å–∞–Ω–∞ II (–í–æ–∏–Ω II)", "how": "–®–∏—Ä–æ–∫–∞—è —Å—Ç–æ–π–∫–∞, –∫–æ–ª–µ–Ω–æ –Ω–∞–¥ –ø—è—Ç–∫–æ–π ‚Äî 30 —Å–µ–∫/—Å—Ç–æ—Ä–æ–Ω–∞."},
    {"title": "–¢—Ä–∏–∫–æ–Ω–∞—Å–∞–Ω–∞ (–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫)", "how": "–ë–æ–∫–æ–≤–æ–π –Ω–∞–∫–ª–æ–Ω, –±–æ–∫–∞ –¥–ª–∏–Ω–Ω—ã–µ ‚Äî 30 —Å–µ–∫/—Å—Ç–æ—Ä–æ–Ω–∞."},
    {"title": "–ü—É—Ä–≤–æ—Ç—Ç–∞–Ω–∞—Å–∞–Ω–∞ (–û–±—Ä–∞—Ç–Ω–∞—è –ø–ª–∞–Ω–∫–∞)", "how": "–¢–∞–∑ –≤–≤–µ—Ä—Ö, –≥—Ä—É–¥—å —Ä–∞—Å–∫—Ä—ã—Ç–∞ ‚Äî 15‚Äì25 —Å–µ–∫."},
    {"title": "–ê—Ä–¥—Ö–∞ —Ö–∞–Ω—É–º–∞–Ω–∞—Å–∞–Ω–∞ (–ü–æ–ª—É—à–ø–∞–≥–∞—Ç)", "how": "–ü–æ–ª—É–≤—ã–ø–∞–¥, –Ω–æ—Å–æ–∫ –Ω–∞ —Å–µ–±—è ‚Äî 30‚Äì40 —Å–µ–∫/—Å—Ç–æ—Ä–æ–Ω–∞."},
    {"title": "–ì–æ–º—É–∫—Ö–∞—Å–∞–Ω–∞ —Ä—É–∫–∏", "how": "–û–¥–Ω–∞ —Ä—É–∫–∞ —Å–≤–µ—Ä—Ö—É, –¥—Ä—É–≥–∞—è —Å–Ω–∏–∑—É ‚Äî 20‚Äì30 —Å–µ–∫/—Å—Ç–æ—Ä–æ–Ω–∞."},
    {"title": "–ü—Ä–∞–Ω–∞–º–∞c–∞–Ω–∞ (–ú–æ–ª–∏—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–∑–∞)", "how": "–õ–∞–¥–æ–Ω–∏ —É –≥—Ä—É–¥–∏, –¥—ã—Ö–∞–Ω–∏–µ —Ä–æ–≤–Ω–æ–µ ‚Äî 30‚Äì60 —Å–µ–∫."},
]

NUTRITION_TIPS: List[str] = [
    "–ü–∏—Ç–∞–π—Å—è –ø–æ —Ä–µ–∂–∏–º—É: 3 –≥–ª–∞–≤–Ω—ã—Ö –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏ + 1‚Äì2 –ø–µ—Ä–µ–∫—É—Å–∞.",
    "–ö–∞–∂–¥—ã–π –ø—Ä–∏—ë–º –≤–∫–ª—é—á–∞–π –±–µ–ª–æ–∫ (—è–π—Ü–∞, —Ä—ã–±–∞, –º—è—Å–æ, –±–æ–±–æ–≤—ã–µ, —Ç–≤–æ—Ä–æ–≥).",
    "–î–æ–±–∞–≤–ª—è–π –∫–ª–µ—Ç—á–∞—Ç–∫—É: –æ–≤–æ—â–∏/–∑–µ–ª–µ–Ω—å 300‚Äì500 –≥ –≤ –¥–µ–Ω—å.",
    "–°–ª–æ–∂–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã: —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤—ã–µ –∫—Ä—É–ø—ã –≤–º–µ—Å—Ç–æ —Å–∞—Ö–∞—Ä–∞ –∏ –±–µ–ª–æ–π –º—É–∫–∏.",
    "–ü–µ–π –≤–æ–¥—É 25‚Äì35 –º–ª/–∫–≥ –º–∞—Å—Å—ã –≤ —Å—É—Ç–∫–∏ (—É—á–∏—Ç—ã–≤–∞–π —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ).",
    "–°–æ–∫—Ä–∞—Ç–∏ —Å–∞—Ö–∞—Ä –∏ —Å–ª–∞–¥–∫–∏–µ –Ω–∞–ø–∏—Ç–∫–∏ ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä—ã–µ –∫–∞–ª–æ—Ä–∏–∏.",
    "–ü–æ–ª–µ–∑–Ω—ã–µ –∂–∏—Ä—ã: –æ–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ, –æ—Ä–µ—Ö–∏, —Å–µ–º–µ–Ω–∞, –∞–≤–æ–∫–∞–¥–æ.",
    "–û–≥—Ä–∞–Ω–∏—á—å —Ç—Ä–∞–Ω—Å–∂–∏—Ä—ã (—Ñ–∞—Å—Ç—Ñ—É–¥, –º–∞—Ä–≥–∞—Ä–∏–Ω—ã).",
    "–°–ª–µ–¥–∏ –∑–∞ —Ç–∞—Ä–µ–ª–∫–æ–π: –ø–æ–ª–æ–≤–∏–Ω–∞ –æ–≤–æ—â–∏, —á–µ—Ç–≤–µ—Ä—Ç—å –±–µ–ª–æ–∫, —á–µ—Ç–≤–µ—Ä—Ç—å —Å–ª–æ–∂–Ω—ã–µ —É–≥–ª–∏.",
    "–ü–µ—Ä–µ–∂—ë–≤—ã–≤–∞–π –º–µ–¥–ª–µ–Ω–Ω–æ ‚Äî —Å–∏–≥–Ω–∞–ª —Å—ã—Ç–æ—Å—Ç–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π.",
    "–ü–ª–∞–Ω–∏—Ä—É–π –º–µ–Ω—é –Ω–∞ 2‚Äì3 –¥–Ω—è –≤–ø–µ—Ä—ë–¥ ‚Äî –º–µ–Ω—å—à–µ —Å—Ä—ã–≤–æ–≤.",
    "–ó–∞–≤—Ç—Ä–∞–∫ —Å –±–µ–ª–∫–æ–º (—è–π—Ü–∞/—Ç–≤–æ—Ä–æ–≥) ‚Äî –º–µ–Ω—å—à–µ —Ç—è–≥–∏ –∫ —Å–ª–∞–¥–∫–æ–º—É.",
    "–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π —Å–æ–ª—å –¥–æ 5 –≥/—Å—É—Ç–∫–∏ (–µ—Å–ª–∏ –Ω–µ—Ç –∏–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –≤—Ä–∞—á–∞).",
    "–§–µ—Ä–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã (–∫–µ—Ñ–∏—Ä, –π–æ–≥—É—Ä—Ç –±–µ–∑ —Å–∞—Ö–∞—Ä–∞) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –º–∏–∫—Ä–æ–±–∏–æ–º.",
    "–î–æ–±–∞–≤–ª—è–π –±–æ–±–æ–≤—ã–µ 2‚Äì4 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é.",
    "–ú–µ–Ω—å—à–µ –∞–ª–∫–æ–≥–æ–ª—è ‚Äî –ø—É—Å—Ç—ã–µ –∫–∞–ª–æ—Ä–∏–∏ –∏ –∞–ø–ø–µ—Ç–∏—Ç —Ä–∞—Å—Ç—ë—Ç.",
    "–ß–∏—Ç–∞–π —Å–æ—Å—Ç–∞–≤: —á–µ–º –∫–æ—Ä–æ—á–µ —Å–ø–∏—Å–æ–∫ ‚Äî —Ç–µ–º –ª—É—á—à–µ.",
    "–ì–æ—Ç–æ–≤—å –¥–æ–º–∞ —á–∞—â–µ ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—à—å —Å–æ—Å—Ç–∞–≤ –∏ –ø–æ—Ä—Ü–∏–∏.",
    "–î–µ—Å–µ—Ä—Ç—ã ‚Äî –ø–æ—Å–ª–µ –µ–¥—ã, –∞ –Ω–µ –≤–º–µ—Å—Ç–æ –Ω–µ—ë.",
    "–°—Ç–∞–±–∏–ª—å–Ω—ã–π —Å–æ–Ω ‚Äî –º–µ–Ω—å—à–µ –Ω–æ—á–Ω—ã—Ö –ø–µ—Ä–µ–∫—É—Å–æ–≤.",
    "–ü–µ—Ä–µ–∫—É—Å—ã–≤–∞–π –ø–æ–ª–µ–∑–Ω–æ: –æ—Ä–µ—Ö–∏ 20‚Äì30 –≥, –π–æ–≥—É—Ä—Ç –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π, —Ñ—Ä—É–∫—Ç—ã.",
    "–°–µ–∑–æ–Ω–Ω—ã–µ –æ–≤–æ—â–∏/—Ñ—Ä—É–∫—Ç—ã –≤–∫—É—Å–Ω–µ–µ –∏ –¥–µ—à–µ–≤–ª–µ.",
    "–î–µ—Ä–∂–∏ –Ω–∞ –≤–∏–¥—É –ø–æ–ª–µ–∑–Ω–æ–µ, ¬´–º—É—Å–æ—Ä¬ª ‚Äî –ø–æ–¥–∞–ª—å—à–µ.",
    "–ï—Å–ª–∏ —Ö—É–¥–µ–µ—à—å: –¥–µ—Ñ–∏—Ü–∏—Ç 10‚Äì15% –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –Ω–µ –∂–µ—Å—Ç–∫–æ.",
    "–î–æ–±–∞–≤—å –±–µ–ª–∫–∞ –ø—Ä–∏ –Ω–∞–±–æ—Ä–µ –º—ã—à—Ü: ~1.6‚Äì2.0 –≥/–∫–≥/—Å—É—Ç–∫–∏.",
    "–û–º–µ–≥–∞-3 –∏–∑ —Ä—ã–±—ã 2‚Äì3 —Ä–∞–∑–∞/–Ω–µ–¥ –∏–ª–∏ –¥–æ–±–∞–≤–∫–∏ (–ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é —Å –≤—Ä–∞—á–æ–º).",
    "–ñ–∏—Ä–Ω–∞—è —Ä—ã–±–∞, —è–π—Ü–∞, –ø–µ—á–µ–Ω—å ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤–∏—Ç–∞–º–∏–Ω–∞ D (–ø—Ä–æ–≤–µ—Ä—å –∞–Ω–∞–ª–∏–∑).",
    "–ö—Ä—É–ø—ã –ø—Ä–æ–º—ã–≤–∞–π –∏ –≤–∞—Ä–∏ ¬´–∞–ª—å –¥–µ–Ω—Ç–µ¬ª ‚Äî –Ω–∏–∂–µ –≥–ª–∏–∫–µ–º–∏—á–µ—Å–∫–∏–π –∏–Ω–¥–µ–∫—Å.",
    "–°—Ç–∞—Ä–∞–π—Å—è –µ—Å—Ç—å –∑–∞ 2‚Äì3 —á–∞—Å–∞ –¥–æ —Å–Ω–∞.",
    "–ù–µ ¬´–Ω–∞–∫–∞–∑—ã–≤–∞–π¬ª —Å–µ–±—è –≥–æ–ª–æ–¥–æ–º ‚Äî –≤—ã–±–∏—Ä–∞–π —É—Å—Ç–æ–π—á–∏–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏.",
    "–ü–µ–π –≤–æ–¥—É –ø–µ—Ä–µ–¥ –∫–æ—Ñ–µ/—á–∞–µ–º ‚Äî –º–µ–Ω—å—à–µ –æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏—è.",
    "–§—Ä—É–∫—Ç—ã ‚Äî —Ü–µ–ª–∏–∫–æ–º, –∞ –Ω–µ —Å–æ–∫.",
    "–°–ª–∞–¥–∫–æ–µ ‚Äî –ø–æ –ø–ª–∞–Ω—É, –∞ –Ω–µ –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ.",
    "–ï—à—å –∫–µ—Ñ–∏—Ä/–π–æ–≥—É—Ä—Ç –ø–æ—Å–ª–µ –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–æ–≤ (–µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–∞–ª–∏—Å—å).",
    "–°—Ç–∞—Ä–∞–π—Å—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—Ç—å –∫—Ä—É–ø—ã: –≥—Ä–µ—á–∫–∞, –±—É–ª–≥—É—Ä, –∫–∏–Ω–æ–∞, –±—É—Ä—ã–π —Ä–∏—Å.",
    "–°–∞–ª–∞—Ç—ã –∑–∞–ø—Ä–∞–≤–ª—è–π –º–∞—Å–ª–æ–º, –∞ –Ω–µ –º–∞–π–æ–Ω–µ–∑–æ–º.",
    "–°–æ–∫—Ä–∞—Ç–∏ –ø–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç—ã ‚Äî –º–Ω–æ–≥–æ —Å–æ–ª–∏ –∏ –¥–æ–±–∞–≤–æ–∫.",
    "–û—Ç—Å–ª–µ–∂–∏–≤–∞–π —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ –ø–æ—Å–ª–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ ‚Äî –ª–∏—á–Ω–∞—è –Ω–µ–ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å –±—ã–≤–∞–µ—Ç.",
    "–ì–æ—Ç–æ–≤—å ¬´–Ω–∞ –∑–∞–≤—Ç—Ä–∞¬ª ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–µ—à–∞—é—Ç.",
    "–†–∞–∑–≥—Ä—É–∑–æ—á–Ω—ã–µ –¥–Ω–∏ –Ω–µ –æ–±—è–∑–∞–Ω—ã –±—ã—Ç—å –≥–æ–ª–æ–¥–Ω—ã–º–∏ ‚Äî –¥–µ–ª–∞–π –∏—Ö ¬´—á–∏—Å—Ç—ã–º–∏¬ª.",
]

LABS: Dict[str, Dict] = {
    "hemoglobin": {
        "name": "–ì–µ–º–æ–≥–ª–æ–±–∏–Ω",
        "normal": "–ú: ~130‚Äì170 –≥/–ª, –ñ: ~120‚Äì150 –≥/–ª (—Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–π –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è)",
        "more": "–ù–∏–∑–∫–∏–π ‚Äî –≤–æ–∑–º–æ–∂–Ω–∞ –∞–Ω–µ–º–∏—è (–∂–µ–ª–µ–∑–æ, B12, —Ñ–æ–ª–∞—Ç). –í—ã—Å–æ–∫–∏–π ‚Äî –æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ, –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –≤—ã—Å–æ—Ç–µ –∏ –¥—Ä."
    },
    "ferritin": {
        "name": "–§–µ—Ä—Ä–∏—Ç–∏–Ω",
        "normal": "–û–±—ã—á–Ω–æ ~20‚Äì250 –Ω–≥/–º–ª (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–ª–∞/–ª–∞–±.)",
        "more": "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–ø–∞—Å—ã –∂–µ–ª–µ–∑–∞. –ù–∏–∑–∫–∏–π ‚Äî –¥–µ—Ñ–∏—Ü–∏—Ç, –≤—ã—Å–æ–∫–∏–π ‚Äî –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ/–ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –∂–µ–ª–µ–∑–æ–º."
    },
    "iron": {
        "name": "–ñ–µ–ª–µ–∑–æ —Å—ã–≤–æ—Ä–æ—Ç–æ—á–Ω–æ–µ",
        "normal": "~9‚Äì30 –º–∫–º–æ–ª—å/–ª",
        "more": "–û—Ü–µ–Ω–∏–≤–∞—é—Ç –≤–º–µ—Å—Ç–µ —Å —Ñ–µ—Ä—Ä–∏—Ç–∏–Ω–æ–º, –û–ñ–°–°, –¢–§–°."
    },
    "vitamin_d": {
        "name": "–í–∏—Ç–∞–º–∏–Ω D (25-OH)",
        "normal": "~30‚Äì100 –Ω–≥/–º–ª (—Å–ø–æ—Ä–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω)",
        "more": "–ù–∏–∑–∫–∏–π ‚Äî —á–∞—Å—Ç–æ –≤ —Å–µ–≤–µ—Ä–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö. –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–æ–±–∞–≤–∫–∞–º–∏ –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é –≤—Ä–∞—á–∞."
    },
    "b12": {
        "name": "B12",
        "normal": "~200‚Äì900 –ø–≥/–º–ª",
        "more": "–ù–∏–∑–∫–∏–π ‚Äî —Å–ª–∞–±–æ—Å—Ç—å, –∞–Ω–µ–º–∏—è, –Ω–µ–≤—Ä–æ–ª. —Å–∏–º–ø—Ç–æ–º—ã."
    },
    "glucose": {
        "name": "–ì–ª—é–∫–æ–∑–∞",
        "normal": "–ù–∞—Ç–æ—â–∞–∫ ~3.9‚Äì5.5 –º–º–æ–ª—å/–ª",
        "more": "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ–≤—ã—à–µ–Ω–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—å HbA1c, –∫ –≤—Ä–∞—á—É."
    },
    "hba1c": {
        "name": "–ì–ª–∏–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥–µ–º–æ–≥–ª–æ–±–∏–Ω (HbA1c)",
        "normal": "~4.0‚Äì5.6%",
        "more": "5.7‚Äì6.4% ‚Äî –ø—Ä–µ–¥–¥–∏–∞–±–µ—Ç, ‚â•6.5% ‚Äî –∫—Ä–∏—Ç–µ—Ä–∏–π –¥–∏–∞–±–µ—Ç–∞ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤—Ä–∞—á)."
    },
    "chol_total": {
        "name": "–•–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω –æ–±—â–∏–π",
        "normal": "–ß–∞—Å—Ç–æ —Ü–µ–ª–µ–≤–æ–π <5.0 –º–º–æ–ª—å/–ª",
        "more": "–°–º–æ—Ç—Ä—è—Ç –≤–º–µ—Å—Ç–µ —Å –õ–ü–ù–ü, –õ–ü–í–ü, –¢–ì –∏ —Ä–∏—Å–∫–æ–º –°–°–ó."
    },
    "ldl": {
        "name": "–õ–ü–ù–ü",
        "normal": "–¶–µ–ª–µ–≤–æ–π –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∏—Å–∫–∞; —á–∞—Å—Ç–æ <3.0, –∞ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º —Ä–∏—Å–∫–µ ‚Äî <1.4‚Äì1.8 –º–º–æ–ª—å/–ª",
        "more": "¬´–ü–ª–æ—Ö–æ–π¬ª —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞—Ä–≥–µ—Ç —Ç–µ—Ä–∞–ø–∏–∏."
    },
    "hdl": {
        "name": "–õ–ü–í–ü",
        "normal": "–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ >1.0‚Äì1.2 –º–º–æ–ª—å/–ª",
        "more": "¬´–•–æ—Ä–æ—à–∏–π¬ª —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω."
    },
    "tg": {
        "name": "–¢—Ä–∏–≥–ª–∏—Ü–µ—Ä–∏–¥—ã",
        "normal": "<1.7 –º–º–æ–ª—å/–ª",
        "more": "–í—ã—Å–æ–∫–∏–µ –¢–ì —á–∞—Å—Ç–æ –ø—Ä–∏ –∏–∑–±—ã—Ç–∫–µ –∫–∞–ª–æ—Ä–∏–π/—Å–∞—Ö–∞—Ä–∞/–∞–ª–∫–æ–≥–æ–ª—è."
    },
    "ast": {
        "name": "–ê–°–¢",
        "normal": "–û–±—ã—á–Ω–æ <40 –ï–¥/–ª",
        "more": "–ü–µ—á—ë–Ω–æ—á–Ω—ã–µ —Ñ–µ—Ä–º–µ–Ω—Ç—ã; –æ—Ü–µ–Ω–∏–≤–∞—é—Ç –≤–º–µ—Å—Ç–µ —Å –ê–õ–¢."
    },
    "alt": {
        "name": "–ê–õ–¢",
        "normal": "–û–±—ã—á–Ω–æ <40 –ï–¥/–ª",
        "more": "–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –ø–æ—Ä–∞–∂–µ–Ω–∏—é –ø–µ—á–µ–Ω–∏."
    },
    "ggt": {
        "name": "–ì–ì–¢",
        "normal": "–û–±—ã—á–Ω–æ <60 –ï–¥/–ª",
        "more": "–ü–æ–≤—ã—à–∞–µ—Ç—Å—è –ø—Ä–∏ —Ö–æ–ª–µ—Å—Ç–∞–∑–µ, –∞–ª–∫–æ–≥–æ–ª–µ –∏ –¥—Ä."
    },
    "bilirubin": {
        "name": "–ë–∏–ª–∏—Ä—É–±–∏–Ω –æ–±—â–∏–π",
        "normal": "~3‚Äì21 –º–∫–º–æ–ª—å/–ª",
        "more": "–°–º–æ—Ç—Ä—è—Ç —Ç–∞–∫–∂–µ –ø—Ä—è–º–æ–π/–Ω–µ–ø—Ä—è–º–æ–π."
    },
    "creatinine": {
        "name": "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω",
        "normal": "–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–ª–∞/–º–∞—Å—Å—ã; –Ω—É–∂–µ–Ω —Ä–∞—Å—á—ë—Ç eGFR",
        "more": "–î–ª—è –æ—Ü–µ–Ω–∫–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—á–µ–∫ —Ä–∞—Å—Å—á–∏—Ç–∞–π eGFR (CKD-EPI)."
    },
    "urea": {
        "name": "–ú–æ—á–µ–≤–∏–Ω–∞",
        "normal": "~2.5‚Äì8.3 –º–º–æ–ª—å/–ª",
        "more": "–†–∞—Å—Ç—ë—Ç –ø—Ä–∏ –æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–∏/–±–µ–ª–∫–æ–≤–æ–º –∏–∑–±—ã—Ç–∫–µ/–Ω–∞—Ä—É—à–µ–Ω–∏–∏ –ø–æ—á–µ–∫."
    },
    "uric": {
        "name": "–ú–æ—á–µ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞",
        "normal": "~200‚Äì420 –º–∫–º–æ–ª—å/–ª",
        "more": "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å ‚Äî —Ä–∏—Å–∫ –ø–æ–¥–∞–≥—Ä—ã/–∫–∞–º–Ω–µ–π."
    },
    "tsH": {
        "name": "–¢–¢–ì",
        "normal": "~0.4‚Äì4.0 –º–ï–¥/–ª",
        "more": "–ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö –ø—Ä–æ–≤–µ—Ä—è—é—Ç T4 —Å–≤–æ–±–æ–¥–Ω—ã–π."
    },
    "t4free": {
        "name": "T4 —Å–≤–æ–±–æ–¥–Ω—ã–π",
        "normal": "–õ–∞–±. —Ä–µ—Ñ–µ—Ä–µ–Ω—Ç—ã",
        "more": "–û—Ü–µ–Ω–∏–≤–∞—é—Ç –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏ –Ω–∞ –¥–∏—Å—Ñ—É–Ω–∫—Ü–∏—é —â–∏—Ç–æ–≤–∏–¥–∫–∏."
    },
    "crp": {
        "name": "–°–†–ë (–≤/—á)",
        "normal": "<1 –º–≥/–ª ‚Äî –Ω–∏–∑–∫–∏–π —Ä–∏—Å–∫",
        "more": "–ú–∞—Ä–∫–µ—Ä –≤–æ—Å–ø–∞–ª–µ–Ω–∏—è/—Ä–∏—Å–∫–∞ –°–°–ó."
    },
    "vitamin_b9": {
        "name": "–§–æ–ª–∞—Ç (B9)",
        "normal": "–õ–∞–±. —Ä–µ—Ñ–µ—Ä–µ–Ω—Ç—ã",
        "more": "–ù–∏–∑–∫–∏–π ‚Äî –∞–Ω–µ–º–∏—è, —É—Ç–æ–º–ª—è–µ–º–æ—Å—Ç—å."
    },
    "magnesium": {
        "name": "–ú–∞–≥–Ω–∏–π",
        "normal": "~0.66‚Äì1.07 –º–º–æ–ª—å/–ª",
        "more": "–°—ã–≤–æ—Ä–æ—Ç–æ—á–Ω—ã–π Mg –Ω–µ –≤—Å–µ–≥–¥–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç –∑–∞–ø–∞—Å—ã."
    },
    "calcium": {
        "name": "–ö–∞–ª—å—Ü–∏–π –æ–±—â–∏–π/–∏–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π",
        "normal": "–õ–∞–±. —Ä–µ—Ñ–µ—Ä–µ–Ω—Ç—ã",
        "more": "–°–º–æ—Ç—Ä–µ—Ç—å —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å –∞–ª—å–±—É–º–∏–Ω–æ–º/–≤–∏—Ç–∞–º–∏–Ω–æ–º D/–ü–¢–ì."
    },
    "potassium": {
        "name": "–ö–∞–ª–∏–π",
        "normal": "~3.5‚Äì5.1 –º–º–æ–ª—å/–ª",
        "more": "–û—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ–ø–∞—Å–Ω—ã –¥–ª—è —Å–µ—Ä–¥—Ü–∞ ‚Äî –∫ –≤—Ä–∞—á—É."
    },
    "sodium": {
        "name": "–ù–∞—Ç—Ä–∏–π",
        "normal": "~135‚Äì145 –º–º–æ–ª—å/–ª",
        "more": "–°–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–æ–¥–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞/–≥–æ—Ä–º–æ–Ω–æ–≤."
    },
    "platelets": {
        "name": "–¢—Ä–æ–º–±–æ—Ü–∏—Ç—ã",
        "normal": "~150‚Äì400 √ó10‚Åπ/–ª",
        "more": "–ù–∏–∑–∫–∏–µ ‚Äî —Ä–∏—Å–∫ –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–π, –≤—ã—Å–æ–∫–∏–µ ‚Äî —Ç—Ä–æ–º–±–æ–∑–æ–≤ (–∫ –≤—Ä–∞—á—É)."
    },
    "wbc": {
        "name": "–õ–µ–π–∫–æ—Ü–∏—Ç—ã",
        "normal": "~4‚Äì9 √ó10‚Åπ/–ª",
        "more": "–ü–æ–≤—ã—à–µ–Ω–∏–µ ‚Äî –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ/–∏–Ω—Ñ–µ–∫—Ü–∏—è, —Å–Ω–∏–∂–µ–Ω–∏–µ ‚Äî –¥—Ä. –ø—Ä–∏—á–∏–Ω—ã."
    },
    "rbc": {
        "name": "–≠—Ä–∏—Ç—Ä–æ—Ü–∏—Ç—ã",
        "normal": "~3.8‚Äì5.8 √ó10¬π¬≤/–ª (–ø–æ–ª/–ª–∞–±.)",
        "more": "–û—Ü–µ–Ω–∏–≤–∞—é—Ç –≤–º–µ—Å—Ç–µ —Å Hb/MCV/MCH."
    },
    "vitamin_b6": {
        "name": "B6",
        "normal": "–õ–∞–±. —Ä–µ—Ñ–µ—Ä–µ–Ω—Ç—ã",
        "more": "–î–µ—Ñ–∏—Ü–∏—Ç ‚Äî —É—Ç–æ–º–ª—è–µ–º–æ—Å—Ç—å, –∫–æ–∂–∞, –Ω–µ—Ä–≤—ã."
    },
    "vitamin_b1": {
        "name": "B1 (–¢–∏–∞–º–∏–Ω)",
        "normal": "–õ–∞–±. —Ä–µ—Ñ–µ—Ä–µ–Ω—Ç—ã",
        "more": "–î–µ—Ñ–∏—Ü–∏—Ç ‚Äî –Ω–µ–≤—Ä–æ–ª. —Å–∏–º–ø—Ç–æ–º—ã, —É—Ç–æ–º–ª—è–µ–º–æ—Å—Ç—å."
    },
}

# –ü—Å–µ–≤–¥–æ–Ω–∏–º—ã –¥–ª—è /analysis
LABS_ALIASES = {
    "–≥–µ–º–æ–≥–ª–æ–±–∏–Ω": "hemoglobin",
    "—Ñ–µ—Ä—Ä–∏—Ç–∏–Ω": "ferritin",
    "–∂–µ–ª–µ–∑–æ": "iron",
    "–≤–∏—Ç–∞–º–∏–Ω d": "vitamin_d",
    "–¥3": "vitamin_d",
    "b12": "b12",
    "–≤12": "b12",
    "–≥–ª—é–∫–æ–∑–∞": "glucose",
    "—Å–∞—Ö–∞—Ä": "glucose",
    "hba1c": "hba1c",
    "–≥–ª–∏–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π": "hba1c",
    "–æ–±—â–∏–π —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω": "chol_total",
    "–ª–ø–Ω–ø": "ldl",
    "–ª–ø–≤–ø": "hdl",
    "—Ç—Ä–∏–≥–ª–∏—Ü–µ—Ä–∏–¥—ã": "tg",
    "–∞—Å—Ç": "ast",
    "–∞–ª—Ç": "alt",
    "–≥–≥—Ç": "ggt",
    "–±–∏–ª–∏—Ä—É–±–∏–Ω": "bilirubin",
    "–∫—Ä–µ–∞—Ç–∏–Ω–∏–Ω": "creatinine",
    "–º–æ—á–µ–≤–∏–Ω–∞": "urea",
    "–º–æ—á–µ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞": "uric",
    "—Ç—Ç–≥": "tsH",
    "t4": "t4free",
    "—Å—Ä–±": "crp",
    "—Ñ–æ–ª–∞—Ç": "vitamin_b9",
    "–º–∞–≥–Ω–∏–π": "magnesium",
    "–∫–∞–ª—å—Ü–∏–π": "calcium",
    "–∫–∞–ª–∏–π": "potassium",
    "–Ω–∞—Ç—Ä–∏–π": "sodium",
    "—Ç—Ä–æ–º–±–æ—Ü–∏—Ç—ã": "platelets",
    "–ª–µ–π–∫–æ—Ü–∏—Ç—ã": "wbc",
    "—ç—Ä–∏—Ç—Ä–æ—Ü–∏—Ç—ã": "rbc",
}

# –í–æ–¥–∞ ‚Äî —Ö—Ä–∞–Ω–∏–º –≤ –ø–∞–º—è—Ç–∏ –ø–æ user_id –∏ –¥–∞—Ç–µ (–Ω–∞ free-–∏–Ω—Å—Ç–∞–Ω—Å–∞—Ö –¥–∞–Ω–Ω—ã—Ö —Ö–≤–∞—Ç–∏—Ç)
WATER: Dict[int, Dict[str, int]] = {}  # {user_id: {"YYYY-MM-DD": ml}}

# ==============================
# –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
# ==============================

def pick_many(items: List, n: int) -> List:
    n = max(1, min(n, min(10, len(items))))  # –æ–≥—Ä–∞–Ω–∏—á–∏–º –¥–æ 10 –∑–∞ —Ä–∞–∑
    return random.sample(items, n)

def today_key() -> str:
    return date.today().isoformat()

def split_chunks(text: str, max_len: int = 3500) -> List[str]:
    # –¥–µ–ª–∏–º –¥–ª–∏–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ª–∏–º–∏—Ç Telegram ~4096)
    parts = []
    while len(text) > max_len:
        cut = text.rfind("\n", 0, max_len)
        if cut == -1:
            cut = max_len
        parts.append(text[:cut])
        text = text[cut:]
    parts.append(text)
    return parts

def biorhythm_for(birth: date, on_date: date) -> Dict[str, float]:
    days = (on_date - birth).days
    import math
    return {
        "physical": math.sin(2 * math.pi * days / 23),
        "emotional": math.sin(2 * math.pi * days / 28),
        "intellectual": math.sin(2 * math.pi * days / 33),
    }

# ==============================
# Handlers
# ==============================

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    kb = [
        ["/exercise", "/meditation", "/yoga"],
        ["/nutrition", "/analysis", "/water"],
        ["/biorhythm", "/help"]
    ]
    await update.message.reply_text(
        "–ü—Ä–∏–≤–µ—Ç! –Ø Life Rhythm. –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã ‚Äî –∂–º–∏ –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ –ø–∏—à–∏ –∫–æ–º–∞–Ω–¥—ã. "
        "–ü–æ–¥—Å–∫–∞–∑–∫–∏: `/exercise 3` ‚Äî –≤—ã–¥–∞–º 3 –∫–æ–º–ø–ª–µ–∫—Å–∞; `/meditation 5` ‚Äî 5 —Ç–µ—Ö–Ω–∏–∫ –∏ —Ç.–¥.",
        reply_markup=ReplyKeyboardMarkup(kb, resize_keyboard=True),
    )

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
        "‚Ä¢ /exercise [n] ‚Äî –∫–æ–º–ø–ª–µ–∫—Å—ã —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π (—É–∫–∞–∂–∏ —á–∏—Å–ª–æ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö)\n"
        "‚Ä¢ /meditation [n] ‚Äî –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ (—É–∫–∞–∂–∏ —á–∏—Å–ª–æ)\n"
        "‚Ä¢ /yoga [n] ‚Äî –π–æ–≥–∞-–ø–æ–∑—ã (—É–∫–∞–∂–∏ —á–∏—Å–ª–æ)\n"
        "‚Ä¢ /nutrition [n] ‚Äî —Å–æ–≤–µ—Ç—ã –ø–æ –ø–∏—Ç–∞–Ω–∏—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5, –º–æ–∂–Ω–æ —á–∏—Å–ª–æ)\n"
        "‚Ä¢ /analysis <–Ω–∞–∑–≤–∞–Ω–∏–µ> ‚Äî —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∞–Ω–∞–ª–∏–∑—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: /analysis –≥–µ–º–æ–≥–ª–æ–±–∏–Ω)\n"
        "‚Ä¢ /analysis list ‚Äî —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤\n"
        "‚Ä¢ /water [add/set/reset] [–º–ª] ‚Äî —É—á—ë—Ç –≤–æ–¥—ã. –ü—Ä–∏–º–µ—Ä—ã: `/water` (–ø–ª—é—Å 250 –º–ª), "
        "`/water add 500`, `/water set 1500`, `/water reset`\n"
        "‚Ä¢ /biorhythm DD.MM.YYYY ‚Äî —Ä–∞—Å—á—ë—Ç –±–∏–æ—Ä–∏—Ç–º–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\n"
        "‚Ä¢ /menu ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏"
    )
    await update.message.reply_text(text)

async def menu_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    kb = [
        ["/exercise", "/meditation", "/yoga"],
        ["/nutrition", "/analysis", "/water"],
        ["/biorhythm", "/help"]
    ]
    await update.message.reply_text("–ú–µ–Ω—é:", reply_markup=ReplyKeyboardMarkup(kb, resize_keyboard=True))

def _format_exercise(item: Dict) -> str:
    steps = "\n".join([f"{i+1}. {s}" for i, s in enumerate(item["steps"])])
    return f"üèÉ {item['title']}\n{steps}\nüí° {item['note']}"

async def exercise(update: Update, context: ContextTypes.DEFAULT_TYPE):
    n = 1
    if context.args:
        try:
            n = int(context.args[0])
        except:
            n = 1
    chosen = pick_many(EXERCISE_SETS, n)
    text = "\n\n".join(_format_exercise(x) for x in chosen)
    for chunk in split_chunks(text):
        await update.message.reply_text(chunk)

async def meditation(update: Update, context: ContextTypes.DEFAULT_TYPE):
    n = 1
    if context.args:
        try:
            n = int(context.args[0])
        except:
            n = 1
    chosen = pick_many(BREATHING_TECHNIQUES, n)
    lines = []
    for x in chosen:
        lines.append(f"üí® {x['title']}\n–ö–∞–∫ –¥–µ–ª–∞—Ç—å: {x['how']}")
    text = "\n\n".join(lines)
    for chunk in split_chunks(text):
        await update.message.reply_text(chunk)

async def yoga(update: Update, context: ContextTypes.DEFAULT_TYPE):
    n = 1
    if context.args:
        try:
            n = int(context.args[0])
        except:
            n = 1
    chosen = pick_many(YOGA_POSES, n)
    lines = [f"üßò {x['title']}\n–ö–∞–∫ –¥–µ–ª–∞—Ç—å: {x['how']}" for x in chosen]
    text = "\n\n".join(lines)
    for chunk in split_chunks(text):
        await update.message.reply_text(chunk)

async def nutrition(update: Update, context: ContextTypes.DEFAULT_TYPE):
    n = 5
    if context.args:
        try:
            n = int(context.args[0])
        except:
            n = 5
    chosen = pick_many(NUTRITION_TIPS, n)
    text = "ü•ó –°–æ–≤–µ—Ç—ã –ø–æ –ø–∏—Ç–∞–Ω–∏—é:\n" + "\n".join([f"‚Ä¢ {t}" for t in chosen])
    for chunk in split_chunks(text):
        await update.message.reply_text(chunk)

async def analysis(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not context.args:
        await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /analysis <–Ω–∞–∑–≤–∞–Ω–∏–µ> –∏–ª–∏ /analysis list")
        return
    key = " ".join(context.args).strip().lower()
    if key == "list":
        keys = sorted({v["name"] for v in LABS.values()})
        rus = sorted(set(list(LABS_ALIASES.keys())))
        text = (
            "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–Ω–∞–ª–∏–∑—ã (–æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è):\n- " + "\n- ".join(keys) +
            "\n\n–ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –ø–æ-—Ä—É—Å—Å–∫–∏: " + ", ".join(rus)
        )
        for ch in split_chunks(text):
            await update.message.reply_text(ch)
        return

    # –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞ –∞–Ω–≥–ª –∫–ª—é—á
    if key in LABS:
        code = key
    else:
        code = LABS_ALIASES.get(key)

    if not code or code not in LABS:
        await update.message.reply_text("–ù–µ —É–∑–Ω–∞–ª –∞–Ω–∞–ª–∏–∑. –ù–∞–ø–∏—à–∏ /analysis list ‚Äî –ø–æ–∫–∞–∂—É, —á—Ç–æ –µ—Å—Ç—å.")
        return

    info = LABS[code]
    text = f"üß™ {info['name']}\n–ù–æ—Ä–º–∞: {info['normal']}\n–ü–æ—è—Å–Ω–µ–Ω–∏–µ: {info['more']}\n\n–í–∞–∂–Ω–æ: –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Å—è –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ç—ã —Å–≤–æ–µ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤—Ä–∞—á–∞."
    await update.message.reply_text(text)

async def water(update: Update, context: ContextTypes.DEFAULT_TYPE):
    uid = update.effective_user.id
    day = today_key()
    user = WATER.setdefault(uid, {})
    current = user.get(day, 0)

    action = None
    value = None
    if context.args:
        if context.args[0].lower() in ("add", "set", "reset"):
            action = context.args[0].lower()
            if action in ("add", "set") and len(context.args) >= 2:
                try:
                    value = int(context.args[1])
                except:
                    value = None

    if action is None:
        # –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º 250 –º–ª
        current += 250
        user[day] = current
        await update.message.reply_text(f"üíß –û—Ç–º–µ—á–µ–Ω–æ 250 –º–ª. –í—Å–µ–≥–æ —Å–µ–≥–æ–¥–Ω—è: {current} –º–ª (—Ü–µ–ª—å ~2000 –º–ª).")
        return

    if action == "reset":
        user[day] = 0
        await update.message.reply_text("‚ôªÔ∏è –°–±—Ä–æ—Å –≤–æ–¥—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è. –¢–µ–∫—É—â–∏–π –æ–±—ä—ë–º: 0 –º–ª.")
        return

    if action == "add":
        if value is None or value <= 0:
            await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /water add 300")
            return
        current += value
        user[day] = current
        await update.message.reply_text(f"üíß –î–æ–±–∞–≤–ª–µ–Ω–æ {value} –º–ª. –í—Å–µ–≥–æ —Å–µ–≥–æ–¥–Ω—è: {current} –º–ª.")
        return

    if action == "set":
        if value is None or value < 0:
            await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /water set 1200")
            return
        user[day] = value
        await update.message.reply_text(f"üîß –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: {value} –º–ª –∑–∞ —Å–µ–≥–æ–¥–Ω—è.")
        return

async def biorhythm(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if not context.args:
        await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /biorhythm DD.MM.YYYY (–¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è)")
        return
    try:
        bdate = datetime.strptime(context.args[0], "%d.%m.%Y").date()
    except Exception:
        await update.message.reply_text("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ü—Ä–∏–º–µ—Ä: /biorhythm 14.02.1990")
        return

    res = biorhythm_for(bdate, date.today())
    def emoji(v):
        return "‚¨ÜÔ∏è" if v > 0.33 else "‚û°Ô∏è" if v > -0.33 else "‚¨áÔ∏è"
    msg = (
        f"üìà –ë–∏–æ—Ä–∏—Ç–º—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:\n"
        f"–§–∏–∑–∏—á–µ—Å–∫–∏–π: {res['physical']:.2f} {emoji(res['physical'])}\n"
        f"–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π: {res['emotional']:.2f} {emoji(res['emotional'])}\n"
        f"–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π: {res['intellectual']:.2f} {emoji(res['intellectual'])}\n"
        "–ó–Ω–∞–∫ > 0 ‚Äî —Ñ–∞–∑–∞ –ø–æ–¥—ä—ë–º–∞, < 0 ‚Äî —Å–ø–∞–¥–∞."
    )
    await update.message.reply_text(msg)

# ==============================
# Telegram Application (PTB 21.x)
# ==============================
application: Application = ApplicationBuilder().token(TOKEN).build()

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã
application.add_handler(CommandHandler("start", start))
application.add_handler(CommandHandler("help", help_command))
application.add_handler(CommandHandler("menu", menu_command))
application.add_handler(CommandHandler("exercise", exercise))
application.add_handler(CommandHandler("meditation", meditation))
application.add_handler(CommandHandler("yoga", yoga))
application.add_handler(CommandHandler("nutrition", nutrition))
application.add_handler(CommandHandler("analysis", analysis))
application.add_handler(CommandHandler("water", water))
application.add_handler(CommandHandler("biorhythm", biorhythm))

# ==============================
# Flask (–ø—Ä–∏—ë–º webhook + health)
# ==============================
app = Flask(__name__)

@app.get("/")
def home():
    return "OK"

@app.get("/healthz")
def healthz():
    # –∏—Å–ø–æ–ª—å–∑—É–µ–º aware-–≤—Ä–µ–º—è –≤ UTC
    return jsonify(ok=True, time=datetime.now().astimezone().isoformat())

@app.post(WEBHOOK_PATH)
async def tg_webhook():
    if request.headers.get("content-type") != "application/json":
        return abort(403)
    data = request.get_json(silent=True, force=True)
    if not data:
        return "no json", 400
    update = Update.de_json(data=data, bot=application.bot)
    await application.process_update(update)
    return "ok", 200

# ==============================
# –°—Ç–∞—Ä—Ç: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, —Å–±—Ä–æ—Å/—É—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook –∏ –∑–∞–ø—É—Å–∫ Flask
# ==============================
async def setup_webhook():
    # –ì–æ—Ç–æ–≤–∏–º PTB –∫ —Ä–∞–±–æ—Ç–µ –≤ webhook-—Ä–µ–∂–∏–º–µ
    await application.initialize()
    # –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —É–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤–µ–±—Ö—É–∫ –∏ —Å—Ç–∞—Ä—ã–µ –∞–ø–¥–µ–π—Ç—ã
    try:
        await application.bot.delete_webhook(drop_pending_updates=True)
    except Exception:
        pass
    # –°—Ç–∞–≤–∏–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –≤–µ–±—Ö—É–∫
    await application.bot.set_webhook(WEBHOOK_URL, allowed_updates=Update.ALL_TYPES)
    # –ó–∞–ø—É—Å–∫–∞–µ–º application (–Ω—É–∂–µ–Ω –¥–ª—è job-–æ—á–µ—Ä–µ–¥–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏)
    await application.start()
    print(f"[OK] Webhook set to {WEBHOOK_URL}")

if __name__ == "__main__":
    # –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    import asyncio
    asyncio.run(setup_webhook())
    # –ó–∞–ø—É—Å–∫ Flask-—Å–µ—Ä–≤–µ—Ä–∞ (Render –¥–µ—Ç–µ–∫—Ç–∏—Ç –ø–æ—Ä—Ç)
    app.run(host="0.0.0.0", port=PORT)
