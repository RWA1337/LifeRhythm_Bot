import os
import telebot
from flask import Flask, request

# –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏ TELEGRAM_TOKEN –≤ Render)
TOKEN = os.environ.get("TELEGRAM_TOKEN")
bot = telebot.TeleBot(TOKEN)

# Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
app = Flask(__name__)

# --- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ---
main_menu = (
    "üåø –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ *LifeRhythm Bot*!\n\n"
    "–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ –Ω–∞ –ø—É—Ç–∏ –∫ –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏: –∑–¥–æ—Ä–æ–≤—å–µ, —Ä–∞–∑–≤–∏—Ç–∏–µ, "
    "–±–∞–ª–∞–Ω—Å –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å.\n\n"
    "üìå –í—ã–±–µ—Ä–∏ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª:\n\n"
    "1Ô∏è‚É£ /health ‚Äî –ó–¥–æ—Ä–æ–≤—å–µ\n"
    "2Ô∏è‚É£ /mind ‚Äî –†–∞–∑–≤–∏—Ç–∏–µ —É–º–∞\n"
    "3Ô∏è‚É£ /soul ‚Äî –î—É—à–∞ –∏ —ç–º–æ—Ü–∏–∏\n"
    "4Ô∏è‚É£ /productivity ‚Äî –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\n"
    "5Ô∏è‚É£ /lifestyle ‚Äî –û–±—Ä–∞–∑ –∂–∏–∑–Ω–∏\n"
    "6Ô∏è‚É£ /practices ‚Äî –ü—Ä–∞–∫—Ç–∏–∫–∏ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è\n"
    "7Ô∏è‚É£ /resources ‚Äî –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã\n"
)

# --- –û—Ç–≤–µ—Ç—ã –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º ---
sections = {
    "health": (
        "üè• *–ó–¥–æ—Ä–æ–≤—å–µ*\n\n"
        "–ó–¥–æ—Ä–æ–≤—å–µ ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏. –ù–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π:\n\n"
        "‚Ä¢ –ü–∏—Ç–∞–Ω–∏–µ: —Å–æ–±–ª—é–¥–∞–π –±–∞–ª–∞–Ω—Å –±–µ–ª–∫–æ–≤, –∂–∏—Ä–æ–≤ –∏ —É–≥–ª–µ–≤–æ–¥–æ–≤.\n"
        "‚Ä¢ –í–æ–¥–∞: 1.5‚Äì2 –ª —á–∏—Å—Ç–æ–π –≤–æ–¥—ã –≤ –¥–µ–Ω—å.\n"
        "‚Ä¢ –°–æ–Ω: 7‚Äì9 —á–∞—Å–æ–≤ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–Ω–∞.\n"
        "‚Ä¢ –î–≤–∏–∂–µ–Ω–∏–µ: —Ö–æ—Ç—è –±—ã 30 –º–∏–Ω—É—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.\n\n"
        "üëâ –ü—Ä–∞–∫—Ç–∏–∫–∞: –≤–≤–µ–¥–∏ –ø—Ä–∏–≤—ã—á–∫—É *—É—Ç—Ä–µ–Ω–Ω–µ–π –∑–∞—Ä—è–¥–∫–∏* –Ω–∞ 5‚Äì10 –º–∏–Ω—É—Ç."
    ),
    "mind": (
        "üß† *–†–∞–∑–≤–∏—Ç–∏–µ —É–º–∞*\n\n"
        "–†–∞–∑–≤–∏—Ç–∏–µ —É–º–∞ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —è—Å–Ω–æ—Å—Ç—å –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.\n\n"
        "‚Ä¢ –ß—Ç–µ–Ω–∏–µ –∫–Ω–∏–≥ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.\n"
        "‚Ä¢ –û–±—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã–º –Ω–∞–≤—ã–∫–∞–º.\n"
        "‚Ä¢ –í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ –∏–¥–µ–π.\n"
        "‚Ä¢ –†–µ—à–µ–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á.\n\n"
        "üëâ –ü—Ä–∞–∫—Ç–∏–∫–∞: –∑–∞–≤–µ–¥–∏ –ø—Ä–∞–≤–∏–ª–æ *30 –º–∏–Ω—É—Ç —á—Ç–µ–Ω–∏—è* –∫–∞–∂–¥—ã–π –≤–µ—á–µ—Ä."
    ),
    "soul": (
        "üíñ *–î—É—à–∞ –∏ —ç–º–æ—Ü–∏–∏*\n\n"
        "–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏.\n\n"
        "‚Ä¢ –ü—Ä–∞–∫—Ç–∏–∫—É–π –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å.\n"
        "‚Ä¢ –û–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –¥—ã—Ö–∞–Ω–∏–µ.\n"
        "‚Ä¢ –ù–∞—Ö–æ–¥–∏ –≤—Ä–µ–º—è –¥–ª—è —Ç–∏—à–∏–Ω—ã.\n"
        "‚Ä¢ –†–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞–π —Å –±–ª–∏–∑–∫–∏–º–∏.\n\n"
        "üëâ –ü—Ä–∞–∫—Ç–∏–∫–∞: –∫–∞–∂–¥—ã–π –≤–µ—á–µ—Ä –∑–∞–ø–∏—Å—ã–≤–∞–π *3 –≤–µ—â–∏*, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω."
    ),
    "productivity": (
        "üìÖ *–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å*\n\n"
        "–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ ‚Äî –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É.\n\n"
        "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π —Ç–µ—Ö–Ω–∏–∫—É Pomodoro (25 –º–∏–Ω —Ä–∞–±–æ—Ç–∞ / 5 –º–∏–Ω –æ—Ç–¥—ã—Ö).\n"
        "‚Ä¢ –ü–ª–∞–Ω–∏—Ä—É–π –¥–µ–Ω—å –≤–µ—á–µ—Ä–æ–º.\n"
        "‚Ä¢ –£–±–∏—Ä–∞–π –æ—Ç–≤–ª–µ–∫–∞—é—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã.\n"
        "‚Ä¢ –†–∞–∑–¥–µ–ª—è–π –≤–∞–∂–Ω–æ–µ –∏ —Å—Ä–æ—á–Ω–æ–µ.\n\n"
        "üëâ –ü—Ä–∞–∫—Ç–∏–∫–∞: –Ω–∞—á–Ω–∏ –¥–µ–Ω—å —Å *—Ç—Ä—ë—Ö –≥–ª–∞–≤–Ω—ã—Ö –∑–∞–¥–∞—á*."
    ),
    "lifestyle": (
        "üåç *–û–±—Ä–∞–∑ –∂–∏–∑–Ω–∏*\n\n"
        "–ó–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏–∑ –ø—Ä–∏–≤—ã—á–µ–∫.\n\n"
        "‚Ä¢ –°—Ç–∞—Ä–∞–π—Å—è –±–æ–ª—å—à–µ –¥–≤–∏–≥–∞—Ç—å—Å—è.\n"
        "‚Ä¢ –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π —Å—Ç—Ä–µ—Å—Å.\n"
        "‚Ä¢ –ü—Ä–æ–≤–æ–¥–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ.\n"
        "‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏.\n\n"
        "üëâ –ü—Ä–∞–∫—Ç–∏–∫–∞: –¥–æ–±–∞–≤—å *–µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –ø—Ä–æ–≥—É–ª–∫—É* 20‚Äì30 –º–∏–Ω—É—Ç."
    ),
    "practices": (
        "üßò *–ü—Ä–∞–∫—Ç–∏–∫–∏ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è*\n\n"
        "–ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞:\n\n"
        "‚Ä¢ –ú–µ–¥–∏—Ç–∞—Ü–∏—è 5‚Äì10 –º–∏–Ω—É—Ç.\n"
        "‚Ä¢ –£—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–∑–º–∏–Ω–∫–∞.\n"
        "‚Ä¢ –î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è.\n"
        "‚Ä¢ –ü—Ä–∞–∫—Ç–∏–∫–∞ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ (–Ω–∞–±–ª—é–¥–∞–π –∑–∞ —Å–æ–±–æ–π).\n\n"
        "üëâ –í—ã–±–µ—Ä–∏ —Ç–æ, —á—Ç–æ –±–ª–∏–∂–µ, –∏ –Ω–∞—á–Ω–∏ —Å –º–∞–ª–æ–≥–æ."
    ),
    "resources": (
        "üìö *–ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã*\n\n"
        "–ö–Ω–∏–≥–∏:\n"
        "‚Ä¢ '–°–∏–ª–∞ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ' ‚Äî –≠–∫—Ö–∞—Ä—Ç –¢–æ–ª–ª–µ\n"
        "‚Ä¢ '7 –Ω–∞–≤—ã–∫–æ–≤ –≤—ã—Å–æ–∫–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –ª—é–¥–µ–π' ‚Äî –°—Ç–∏–≤–µ–Ω –ö–æ–≤–∏\n"
        "‚Ä¢ '–ê—Ç–æ–º–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏' ‚Äî –î–∂–µ–π–º—Å –ö–ª–∏—Ä\n\n"
        "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è:\n"
        "‚Ä¢ Headspace ‚Äî –º–µ–¥–∏—Ç–∞—Ü–∏–∏\n"
        "‚Ä¢ Notion ‚Äî –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á\n"
        "‚Ä¢ Habitica ‚Äî —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–∏–≤—ã—á–µ–∫\n\n"
        "üëâ –ò—Å–ø–æ–ª—å–∑—É–π –∏—Ö –¥–ª—è —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –≥–∞—Ä–º–æ–Ω–∏–∏."
    ),
}

# --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ ---
@bot.message_handler(commands=["start", "help"])
def send_welcome(message):
    bot.send_message(message.chat.id, main_menu, parse_mode="Markdown")

@bot.message_handler(commands=list(sections.keys()))
def section_handler(message):
    command = message.text.lstrip("/")
    response = sections.get(command, "–†–∞–∑–¥–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω ü§î")
    bot.send_message(message.chat.id, response, parse_mode="Markdown")

# --- Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ ---
@app.route("/webhook", methods=["POST"])
def webhook():
    json_str = request.get_data().decode("UTF-8")
    update = telebot.types.Update.de_json(json_str)
    bot.process_new_updates([update])
    return "ok", 200

@app.route("/", methods=["GET"])
def index():
    return "LifeRhythm Bot —Ä–∞–±–æ—Ç–∞–µ—Ç!", 200

# --- –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
if __name__ == "__main__":
    PORT = int(os.environ.get("PORT", 10000))
    app.run(host="0.0.0.0", port=PORT)
